<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>東京都公園樹木健康監視システム</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" 
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" 
          crossorigin=""/>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <!-- ヘッダー -->
        <header class="header">
            <h1>🌳 東京都公園樹木健康監視システム</h1>
            <p>衛星データによる樹木健康状態の可視化</p>
        </header>

        <!-- メインコンテンツ -->
        <div class="main-content">
            <!-- 地図エリア -->
            <div class="map-container">
                <div id="map"></div>
                <div class="map-controls">
                    <div class="legend">
                        <h3>凡例</h3>
                        <div class="legend-item">
                            <span class="legend-color park-polygon"></span>
                            <span>公園エリア</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-color selected-park"></span>
                            <span>選択中の公園</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-color citizen-report"></span>
                            <span>市民レポート</span>
                        </div>
                    </div>
                    
                    <!-- 市民レポートボタン -->
                    <div class="citizen-report-controls">
                        <button id="citizen-report-btn" class="report-button">
                            📸 樹木の状態を報告
                        </button>
                        <button id="toggle-reports-btn" class="toggle-button">
                            👥 市民レポートを表示
                        </button>
                    </div>
                </div>
            </div>

            <!-- サイドパネル -->
            <div class="side-panel">
                <div class="panel-header">
                    <h2>📊 時系列分析</h2>
                </div>
                
                <div class="panel-content">
                    <div id="no-selection" class="placeholder">
                        <p>🗺️ 地図上の公園をクリックして時系列データを表示</p>
                    </div>
                    
                    <div id="chart-container" style="display: none;">
                        <div class="park-info">
                            <h3 id="park-name">公園名</h3>
                            <p id="park-id">ID: </p>
                        </div>
                        
                        <div class="chart-wrapper">
                            <canvas id="timeseriesChart"></canvas>
                        </div>
                        
                        <div class="data-info">
                            <h4>指標説明</h4>
                            <ul>
                                <li><strong>NDVI</strong>: 正規化植生指数（緑の健康度）</li>
                                <li><strong>NDRE</strong>: 正規化差分レッドエッジ指数</li>
                                <li><strong>PSRI</strong>: 植物老化反射指数</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 市民レポートモーダル -->
        <div id="citizen-report-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>🌳 樹木の状態を報告</h2>
                    <span class="close">&times;</span>
                </div>
                
                <form id="citizen-report-form" enctype="multipart/form-data">
                    <div class="form-section">
                        <h3>📸 写真アップロード</h3>
                        <div class="file-upload-wrapper">
                            <input type="file" id="tree-image" name="image" accept="image/*" capture="environment" required>
                            <label for="tree-image" class="file-upload-label">
                                <span class="upload-icon">📷</span>
                                <span class="upload-text">樹木の写真を選択</span>
                            </label>
                        </div>
                        <div id="image-preview" class="image-preview"></div>
                    </div>
                    
                    <div class="form-section">
                        <h3>📍 位置情報</h3>
                        <div class="location-options">
                            <label class="radio-option">
                                <input type="radio" name="location-method" value="current" checked>
                                <span>現在位置を使用</span>
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="location-method" value="map">
                                <span>地図から選択</span>
                            </label>
                        </div>
                        
                        <div id="current-location" class="location-section">
                            <button type="button" id="get-current-location" class="location-button">
                                🎯 現在位置を取得
                            </button>
                            <div id="location-status" class="location-status"></div>
                        </div>
                        
                        <div id="map-location" class="location-section" style="display: none;">
                            <p>地図上でクリックして位置を選択してください</p>
                            <div id="location-map" class="location-map"></div>
                            <div id="selected-location" class="location-display"></div>
                        </div>
                        
                        <input type="hidden" id="latitude" name="latitude">
                        <input type="hidden" id="longitude" name="longitude">
                    </div>
                    
                    <div class="form-section">
                        <h3>📋 報告内容</h3>
                        <div class="form-group">
                            <label for="report-type">報告の種類</label>
                            <select id="report-type" name="report_type" required>
                                <option value="健康チェック">健康チェック</option>
                                <option value="病気の疑い">病気の疑い</option>
                                <option value="枯れの疑い">枯れの疑い</option>
                                <option value="倒木リスク">倒木リスク</option>
                                <option value="害虫発見">害虫発見</option>
                                <option value="その他">その他</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="severity">深刻度 (1: 軽微 ～ 5: 緊急)</label>
                            <input type="range" id="severity" name="severity" min="1" max="5" value="3" class="severity-slider">
                            <div class="severity-labels">
                                <span>軽微</span>
                                <span id="severity-value">3</span>
                                <span>緊急</span>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="description">詳細説明 (任意)</label>
                            <textarea id="description" name="description" rows="3" placeholder="樹木の状態について詳しく記述してください..."></textarea>
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="cancel-button">キャンセル</button>
                        <button type="submit" class="submit-button">
                            🚀 報告を送信
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- 分析結果モーダル -->
        <div id="analysis-result-modal" class="modal">
            <div class="modal-content analysis-modal">
                <div class="modal-header">
                    <h2>🤖 AI分析結果</h2>
                    <span class="close">&times;</span>
                </div>
                <div id="analysis-content" class="analysis-content">
                    <!-- 分析結果がここに表示される -->
                </div>
            </div>
        </div>

        <!-- フッター -->
        <footer class="footer">
            <p>© 2024 東京都知事杯オープンデータハッカソン | データソース: Sentinel-2衛星データ</p>
        </footer>
    </div>

    <!-- Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" 
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" 
            crossorigin=""></script>
    
    <!-- Custom JavaScript -->
    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html> 